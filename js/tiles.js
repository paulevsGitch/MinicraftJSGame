class Tile{constructor(a){this.name=a,this.renderOrder=0,this.id=0}draw(a,b,c,d,e,f){}}class ImageTile extends Tile{constructor(a,b){super(a),this.image=b}draw(d,a,b,c,e,f){a.drawImage(this.image,b<<4,c<<4)}drawPart(a,b,c,d,e){a.drawImage(this.image,d,e,16,16,b,c,16,16)}}class SplatTile extends ImageTile{constructor(a,b){super(a,b),this.renderOrder=Tiles.globalSplatID++}draw(d,a,b,c,e,f){this.drawPart(a,b<<4,c<<4,16,16),MathHelper.neighbours8.forEach(g=>{let i=e+g.x,j=f+g.y,h=d.getTile(i,j);h!=this&&h.renderOrder<this.renderOrder&&this.drawPart(a,b+g.x<<4,c+g.y<<4,g.x+1<<4,g.y+1<<4)})}}class WaterTile extends ImageTile{constructor(a,b){super(a,b)}draw(e,a,i,j,f,d){let b=i<<4,c=j<<4;if(d>0&&e.getTile(f,d-1)!=this){let g=e.getTile(f+1,d)==this,h=e.getTile(f-1,d)==this;g&&h?this.drawPart(a,b,c,16,16):g?this.drawPart(a,b,c,32,0):h?this.drawPart(a,b,c,0,0):this.drawPart(a,b,c,16,0)}else this.drawPart(a,b,c,0,16)}}const Tiles={values:[],globalSplatID:1,overlayRender:[]};Tiles.registerTile=function(a){var b=Tiles.values,c=b.length;return void 0===b[c]&&(b[c]=a,a.id=c),a},Tiles.registerOverlayRender=function(a,b){Tiles.overlayRender[a.id]=b},Tiles.stone=Tiles.registerTile(new SplatTile("stone",Images.load("img/tiles/stone.png"))),Tiles.sand=Tiles.registerTile(new SplatTile("sand",Images.load("img/tiles/sand.png"))),Tiles.grass=Tiles.registerTile(new SplatTile("grass",Images.load("img/tiles/grass.png"))),Tiles.water=Tiles.registerTile(new WaterTile("water",Images.load("img/tiles/water.png"))),Tiles.stone.smallStones=Images.load("img/sprites/small_stones.png"),Tiles.registerOverlayRender(Tiles.stone,(a,b,c)=>{if(.5>Math.random()){let d=Math.floor(8*Math.random())|b<<4,e=Math.floor(8*Math.random())|c<<4,f=Math.floor(2*Math.random())<<3,g=Math.floor(2*Math.random())<<3;a.drawImage(Tiles.stone.smallStones,f,g,8,8,d,e,8,8)}}),Tiles.grass.smallGrass=Images.load("img/sprites/small_grass.png"),Tiles.registerOverlayRender(Tiles.grass,(a,b,c)=>{if(.5>Math.random()){let d=MathHelper.randomInt(8)|b<<4,e=MathHelper.randomInt(8)|c<<4,f=MathHelper.randomInt(2)<<3,g=MathHelper.randomInt(2)<<3;a.drawImage(Tiles.grass.smallGrass,f,g,8,8,d,e,8,8)}}),Tiles.sand.smallStones=Images.load("img/sprites/small_sand_stones.png"),Tiles.registerOverlayRender(Tiles.sand,(a,b,c)=>{if(.5>Math.random()){let d=Math.floor(4*Math.random())|b<<4|4,e=Math.floor(4*Math.random())|c<<4|4,f=Math.floor(2*Math.random())<<3,g=Math.floor(2*Math.random())<<3;a.drawImage(Tiles.sand.smallStones,f,g,8,8,d,e,8,8)}})