(WorldGenerator={}).walls=function(a,e,f,g,h,b){for(let c=e;c<=g;c++)a.setTile(c,f,b),a.setTile(c,h,b);for(let d=f+1;d<h;d++)a.setTile(e,d,b),a.setTile(g,d,b)},WorldGenerator.fillCircle=function(e,f,g,d,h,i){let j=d*d,c=Math.ceil(d);for(let a=-c;a<=c;a++){let k=a*a;for(let b=-c;b<=c;b++)k+b*b<=j&&(void 0===i||i==e.getTile(f+a,g+b,h))&&e.setTile(f+a,g+b,h)}},WorldGenerator.fillChunk=function(b,c){for(let a=0;a<256;a++)b.tiles[a]=c;b.needUpdate=!0},WorldGenerator.generateWorld=function(a){let d=a.size<<4,j=a.size>>1,b=d>>1;for(let k=0;k<a.size;k++)for(let l=0;l<a.size;l++){let m=a.getOrCreateChunk(k,l);WorldGenerator.fillChunk(m,Tiles.water),m.entities.clear()}let c=(5*Math.random()+5)*j;WorldGenerator.fillCircle(a,b,b,c,Tiles.grass);let e=Math.floor((5*Math.random()+5)*j);for(let n=0;n<e;n++){let t=Math.floor((2*Math.random()-1)*c)+b,u=Math.floor((2*Math.random()-1)*c)+b,v=2*Math.random()+2;WorldGenerator.fillCircle(a,t,u,v,Tiles.stone,Tiles.grass)}e=Math.floor((3*Math.random()+3)*j);for(let o=0;o<e;o++){let p=6.283*Math.random(),w=Math.floor(Math.sin(p)*c+b),x=Math.floor(Math.cos(p)*c+b),y=3*Math.random()+3;WorldGenerator.fillCircle(a,w,x,y,Tiles.grass)}c*=1.2,e=Math.floor((3*Math.random()+3)*j);for(let q=0;q<e;q++){let r=6.283*Math.random(),z=Math.floor(Math.sin(r)*c+b),A=Math.floor(Math.cos(r)*c+b),B=1.7*Math.random()+1.6;WorldGenerator.fillCircle(a,z,A,B,Tiles.grass)}WorldGenerator.walls(a,0,0,d-1,d-1,Tiles.water);for(let f=0;f<d;f++)for(let g=0;g<d;g++)a.getTile(f,g)==Tiles.grass&&WorldGenerator.isNear(a,f,g,Tiles.water)&&WorldGenerator.fillCircle(a,f,g,1,Tiles.sand,Tiles.grass);for(let h=0;h<d;h++)for(let i=0;i<d;i++){let s=a.getTile(h,i);s==Tiles.grass&&.1>Math.random()?a.addEntity(new SimpleTree(h+MathHelper.randomRange(.4,.6),i+MathHelper.randomRange(.4,.6))):s==Tiles.grass&&.3>Math.random()&&a.addEntity(new TallGrassPlant(h+MathHelper.randomRange(.4,.6),i+MathHelper.randomRange(.4,.6)))}if(a.players.size>0){let C=[];a.players.forEach(a=>C.push(a)),a.players.clear(),C.forEach(b=>a.addEntity(b))}},WorldGenerator.isNear=function(c,d,e,f){for(let a=0;a<4;a++){let b=MathHelper.neighbours4[a];if(c.getTile(d+b.x,e+b.y)==f)return!0}return!1}