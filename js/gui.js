const GUI={};GUI.textures={},GUI.textures.button=Images.load("img/gui/button.png");class GUIElement{constructor(){this.position=new Vec2,this.size=new Vec2,this.size=new Vec2}render(a){}process(a,b){}}class Button extends GUIElement{constructor(a,b,c,d,e){super(),this.size=a,this.text=d,this.onClick=e,this.corner=b,this.fontSize=c,this.boundingBox=new BoundingBox(this.position,this.size)}render(a){a.fillStyle="white",Render.setFont(a,this.fontSize),Render.drawNineElements(a,GUI.textures.button,this.position.x,this.position.y,this.size.x,this.size.y,this.corner);let b=this.text;this.boundingBox.isInside(Controls.mouse.x,Controls.mouse.y)&&(b="> "+this.text+" <"),Render.printCentered(a,b,this.position.x+(this.size.x>>1),this.position.y+(this.size.y>>1))}process(a,b){void 0!=this.onClick&&this.boundingBox.isInside(a,b)&&this.onClick()}}GUI.makeDefaultButton=function(a,b){return new Button(new Vec2(512,128),32,64,a,b)};class Simple9Part extends GUIElement{constructor(a,b){super(),this.image=a,this.corner=b}render(a){Render.drawNineElements(a,this.image,this.position.x,this.position.y,this.size.x,this.size.y,this.corner)}}class ScaledImage extends GUIElement{constructor(a,b){super(),this.image=a,this.scale=b,this.size.set(a.width*b,a.height*b)}render(a){let b=this.image.width*this.scale,c=this.image.height*this.scale;a.drawImage(this.image,this.position.x,this.position.y,b,c)}}class Screen{constructor(a){this.elements=[],this.parent=a}addElement(a){this.elements.push(a)}render(a){Render.enableSmooth(a.context,!1),this.elements.forEach(b=>b.render(a.context)),Render.enableSmooth(a.context,!0)}onClick(a,b){this.elements.forEach(c=>c.process(a,b))}onResize(a,b,c){void 0!=this.parent&&this.parent.onResize(a,b,c)}onTick(){void 0!=this.parent&&Controls.isKeyPressed("Escape")&&this.returnToParent()}returnToParent(){Minicraft.screen=this.parent}}class MainMenuScreen extends Screen{constructor(){super(),this.logo=new ScaledImage(Images.load("img/gui/logo.png"),8),this.addElement(this.logo),this.border=new Simple9Part(Images.load("img/gui/borders.png"),64),this.addElement(this.border);let a=this;this.startButton=GUI.makeDefaultButton("START",function(){Minicraft.screen=new WorldScreen(a)}),this.addElement(this.startButton),this.optionsButton=GUI.makeDefaultButton("OPTIONS",function(){console.log("B")}),this.addElement(this.optionsButton)}onResize(a,b,c){super.onResize(a,b,c),this.logo.position.set(a.x-(this.logo.image.width<<2),(a.y>>1)-(this.logo.image.height<<3)),this.border.size.set(b,c),this.startButton.position.set(a.x-256,a.y-64-70),this.optionsButton.position.set(this.startButton.position.x,a.y-64+70)}}class WorldScreen extends Screen{constructor(b){super(b),this.world=new World(4),WorldGenerator.generateWorld(this.world),Minicraft.inWorld=!0;let a=new PlayerEntity;a.position.set(31,31),this.world.addEntity(a),Minicraft.renderContext.camera.target=a,this.light=Images.load("img/light/light_64.png")}render(c){let f=c.canvas.height,g=c.canvas.width,a=c.camera,b=c.context,d=c.lightmap;this.world.tick(c.delta),void 0!=a.target&&a.position.set(a.target.position).multiply(16).subtract(0,8),Render.enableSmooth(b,!1),b.transform(a.zoom,0,0,a.zoom,.5*g,.5*f),b.transform(1,0,0,1,-a.position.x,-a.position.y);let i=b.getTransform();this.world.render(b);let h=Controls.mouse,j=((h.x-.5*g)/a.zoom+a.position.x)/16,k=((h.y-.5*f)/a.zoom+a.position.y)/16,e=c.screenArea;e.position.set(-(.5*g),-(.5*f)).divide(a.zoom).add(a.position).divide(16),e.size.set(g,f).divide(16*a.zoom),Entities.mutableBox.size.set(4),this.world.visibleEntities.forEach(a=>{Entities.mutableBox.position.set(a.position).subtract(2),a.visible=e.collides(Entities.mutableBox)}),Entities.mutableBox.size.set(1),b.strokeStyle="white",b.beginPath(),b.rect(16*e.position.x+1,16*e.position.y+1,16*e.size.x-2,16*e.size.y-2),b.stroke(),this.selected=void 0,this.world.visibleEntities.forEach(a=>{if(void 0!=a.selectionBox&&a.selectionBox.isInside(j,k))return a.selected=!0,this.selected=a,!0}),b.setTransform(),this.world.setAmbientLight(d.context,c.time),Render.enableSmooth(d.context,!1),d.context.setTransform(),Render.defaultBlending(d.context),d.context.fillRect(0,0,g,f),d.context.setTransform(i),Render.screenBlending(d.context),d.context.drawImage(this.light,a.position.x-(this.light.width>>1),a.position.y-(this.light.height>>1)),Render.multiplyBlending(b),c.context.drawImage(d.canvas,0,0),Render.defaultBlending(b),Render.enableSmooth(b,!0)}onTick(){super.onTick(),Controls.isKeyPressed("KeyR")&&WorldGenerator.generateWorld(this.world);let a=Minicraft.renderContext.camera;void 0===a.target&&(a.movement.set(0,0),Controls.isKeyHold("KeyW")&&(a.movement.y-=1),Controls.isKeyHold("KeyS")&&(a.movement.y+=1),Controls.isKeyHold("KeyA")&&(a.movement.x-=1),Controls.isKeyHold("KeyD")&&(a.movement.x+=1),a.position.add(a.movement.normalize().multiply(100*Minicraft.renderContext.delta)))}onClick(a,b){super.onClick(a,b),void 0!=this.selected&&(this.selected.alive=!1)}returnToParent(){super.returnToParent(),Minicraft.inWorld=!1}}